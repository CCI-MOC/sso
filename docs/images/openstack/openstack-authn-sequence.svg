<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="849px" preserveAspectRatio="none" style="width:1577px;height:849px;background:#FFFFFF;" version="1.1" viewBox="0 0 1577 849" width="1577px" zoomAndPan="magnify"><defs><filter height="300%" id="f1rmqijt1337mi" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="88.2969" y2="765.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="791" x2="791" y1="88.2969" y2="765.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="874" x2="874" y1="88.2969" y2="765.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1057" x2="1057" y1="88.2969" y2="765.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1326.5" x2="1326.5" y1="88.2969" y2="765.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1447.5" x2="1447.5" y1="88.2969" y2="765.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1547.5" x2="1547.5" y1="88.2969" y2="765.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="84.9951">User</text><ellipse cx="23.5" cy="15" fill="#FEFECE" filter="url(#f1rmqijt1337mi)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M23.5,23 L23.5,50 M10.5,31 L36.5,31 M23.5,50 L10.5,65 M23.5,50 L36.5,65 " fill="none" filter="url(#f1rmqijt1337mi)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="777.6123">User</text><ellipse cx="23.5" cy="790.9141" fill="#FEFECE" filter="url(#f1rmqijt1337mi)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M23.5,798.9141 L23.5,825.9141 M10.5,806.9141 L36.5,806.9141 M23.5,825.9141 L10.5,840.9141 M23.5,825.9141 L36.5,840.9141 " fill="none" filter="url(#f1rmqijt1337mi)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f1rmqijt1337mi)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="69" x="755" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="762" y="72.9951">Horizon</text><rect fill="#FEFECE" filter="url(#f1rmqijt1337mi)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="69" x="755" y="764.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="762" y="784.6123">Horizon</text><rect fill="#FEFECE" filter="url(#f1rmqijt1337mi)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="68" x="838" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="845" y="72.9951">Apache</text><rect fill="#FEFECE" filter="url(#f1rmqijt1337mi)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="68" x="838" y="764.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="845" y="784.6123">Apache</text><rect fill="#FEFECE" filter="url(#f1rmqijt1337mi)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="82" x="1014" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="1021" y="72.9951">Keystone</text><rect fill="#FEFECE" filter="url(#f1rmqijt1337mi)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="82" x="1014" y="764.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="1021" y="784.6123">Keystone</text><rect fill="#FEFECE" filter="url(#f1rmqijt1337mi)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="79" x="1285.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="1292.5" y="72.9951">Keycloak</text><rect fill="#FEFECE" filter="url(#f1rmqijt1337mi)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="79" x="1285.5" y="764.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="1292.5" y="784.6123">Keycloak</text><rect fill="#FEFECE" filter="url(#f1rmqijt1337mi)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="135" x="1378.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121" x="1385.5" y="72.9951">Identity Provider</text><rect fill="#FEFECE" filter="url(#f1rmqijt1337mi)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="135" x="1378.5" y="764.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121" x="1385.5" y="784.6123">Identity Provider</text><rect fill="#FEFECE" filter="url(#f1rmqijt1337mi)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="36" x="1527.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="1534.5" y="72.9951">IdP</text><rect fill="#FEFECE" filter="url(#f1rmqijt1337mi)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="36" x="1527.5" y="764.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="1534.5" y="784.6123">IdP</text><polygon fill="#A80036" points="779.5,115.4297,789.5,119.4297,779.5,123.4297,783.5,119.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="23.5" x2="785.5" y1="119.4297" y2="119.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="373" x="30.5" y="114.3638">POST https://kaizen.massopen.cloud/dashboard/auth/login</text><polygon fill="#A80036" points="34.5,127.4297,24.5,131.4297,34.5,135.4297,30.5,131.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="790.5" y1="131.4297" y2="131.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="744" x="40.5" y="144.4966">302 https://kaizen.massopen.cloud:13000/v3/auth/OS-FEDERATION/identity_providers/moc/protocols/openid/websso</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="40.5" y="159.6294">?</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="474" x="47.5" y="159.6294">origin=https://kaizen.massopen.cloud/dashboard/auth/websso/</text><polygon fill="#A80036" points="862,188.8281,872,192.8281,862,196.8281,866,192.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="23.5" x2="868" y1="192.8281" y2="192.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="30.5" y="187.7622">Follows redirect via GET</text><polygon fill="#A80036" points="34.5,200.8281,24.5,204.8281,34.5,208.8281,30.5,204.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="873" y1="204.8281" y2="204.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="517" x="40.5" y="217.895">302 https://sso.massopen.cloud/auth/realms/moc/protocol/openid-connect/auth?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="666" x="40.5" y="233.0278">response_type=id_token&amp;scope=openid%20email%20profile&amp;client_id=kaizen&amp;state=xxx&amp;nonce=xxx</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="40.5" y="248.1606">&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="685" x="50.5" y="248.1606">redirect_uri=https://kaizen.massopen.cloud:13000/v3/auth/OS-FEDERATION/websso/openid</text><polygon fill="#A80036" points="1315,277.3594,1325,281.3594,1315,285.3594,1319,281.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="23.5" x2="1321" y1="281.3594" y2="281.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="30.5" y="276.2935">Follows redirect via GET</text><polygon fill="#A80036" points="34.5,289.3594,24.5,293.3594,34.5,297.3594,30.5,293.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="28.5" x2="1326" y1="293.3594" y2="293.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="40.5" y="306.4263">Identity provider selection page</text><polygon fill="#A80036" points="1315,335.625,1325,339.625,1315,343.625,1319,339.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="23.5" x2="1321" y1="339.625" y2="339.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="30.5" y="334.5591">Selected "University Login"</text><polygon fill="#A80036" points="34.5,347.625,24.5,351.625,34.5,355.625,30.5,351.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="1326" y1="351.625" y2="351.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="939" x="40.5" y="364.6919">303 https://cilogon.org/authorize?scope=openid+email+profile+org.cilogon.userinfo&amp;state=xxx&amp;response_type=code&amp;client_id=xxx&amp;nonce=xxx</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="40.5" y="379.8247">&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="627" x="50.5" y="379.8247">redirect_uri=https://sso.massopen.cloud/auth/realms/moc/broker/cilogon/endpoint</text><polygon fill="#A80036" points="1535.5,409.0234,1545.5,413.0234,1535.5,417.0234,1539.5,413.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="23.5" x2="1541.5" y1="413.0234" y2="413.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="439" x="30.5" y="407.9575">Follows redirect via GET, selects identity provider, and authenticates</text><polygon fill="#A80036" points="34.5,421.0234,24.5,425.0234,34.5,429.0234,30.5,425.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="28.5" x2="1546.5" y1="425.0234" y2="425.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="479" x="40.5" y="438.0903">302 https://sso.massopen.cloud/auth/realms/moc/broker/cilogon/endpoint?</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="70" x="519.5" y="438.0903">code=xxx</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="589.5" y="438.0903">&amp;state=xxx</text><polygon fill="#A80036" points="1315,467.2891,1325,471.2891,1315,475.2891,1319,471.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="23.5" x2="1321" y1="471.2891" y2="471.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="30.5" y="466.2231">Follows redirect via GET</text><polygon fill="#A80036" points="34.5,479.2891,24.5,483.2891,34.5,487.2891,30.5,483.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="1326" y1="483.2891" y2="483.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="750" x="40.5" y="496.356">302 https://kaizen.massopen.cloud:13000/v3/auth/OS-FEDERATION/websso/openid#state=xxx&amp;session_state=xxx&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="99" x="790.5" y="496.356">id_token=xxx</text><polygon fill="#A80036" points="862,525.5547,872,529.5547,862,533.5547,866,529.5547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="23.5" x2="868" y1="529.5547" y2="529.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="30.5" y="524.4888">Follows redirect via GET</text><polygon fill="#A80036" points="1045,554.6875,1055,558.6875,1045,562.6875,1049,558.6875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="874" x2="1051" y1="558.6875" y2="558.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="881" y="553.6216">Parses id_token into ENV</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1057" x2="1099" y1="602.9531" y2="602.9531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1099" x2="1099" y1="602.9531" y2="615.9531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1058" x2="1099" y1="615.9531" y2="615.9531"/><polygon fill="#A80036" points="1068,611.9531,1058,615.9531,1068,619.9531,1064,615.9531" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256" x="1064" y="582.7544">Parses ENV into user based on mapping</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="1064" y="597.8872">Creates user if needed</text><polygon fill="#A80036" points="34.5,623.9531,24.5,627.9531,34.5,631.9531,30.5,627.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="28.5" x2="1056" y1="627.9531" y2="627.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316" x="40.5" y="641.02">200 OK, sends the user via POST Form to Horizon</text><polygon fill="#A80036" points="779.5,685.3516,789.5,689.3516,779.5,693.3516,783.5,689.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="23.5" x2="785.5" y1="689.3516" y2="689.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="396" x="30.5" y="669.1528">POST https://kaizen.massopen.cloud/dashboard/auth/websso/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="30.5" y="684.2856">FORM DATA:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="79" x="115.5" y="684.2856">token: xxx</text><polygon fill="#A80036" points="34.5,697.3516,24.5,701.3516,34.5,705.3516,30.5,701.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="28.5" x2="790.5" y1="701.3516" y2="701.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="300" x="40.5" y="714.4185">302 https://kaizen.massopen.cloud/dashboard/</text><polygon fill="#A80036" points="779.5,743.6172,789.5,747.6172,779.5,751.6172,783.5,747.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="23.5" x2="785.5" y1="747.6172" y2="747.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="30.5" y="742.5513">Authentication is succesful, dashboard logs user into project</text><!--MD5=[376ff21f501ed27c49fd936f74e965e2]
@startuml
skinparam responseMessageBelowArrow true

actor User
participant Horizon
participant Apache
participant Keystone
participant Keycloak
participant "Identity Provider" as Idp

User -> Horizon: POST https://kaizen.massopen.cloud/dashboard/auth/login
Horizon - -> User: 302 https://kaizen.massopen.cloud:13000/v3/auth/OS-FEDERATION/identity_providers/moc/protocols/openid/websso\n?**origin=https://kaizen.massopen.cloud/dashboard/auth/websso/**
User -> Apache: Follows redirect via GET
Apache - -> User: 302 https://sso.massopen.cloud/auth/realms/moc/protocol/openid-connect/auth?\nresponse_type=id_token&scope=openid%20email%20profile&client_id=kaizen&state=xxx&nonce=xxx\n&**redirect_uri=https://kaizen.massopen.cloud:13000/v3/auth/OS-FEDERATION/websso/openid**
User -> Keycloak: Follows redirect via GET
Keycloak -> User: Identity provider selection page
User -> Keycloak: Selected "University Login"
Keycloak - -> User: 303 https://cilogon.org/authorize?scope=openid+email+profile+org.cilogon.userinfo&state=xxx&response_type=code&client_id=xxx&nonce=xxx\n&**redirect_uri=https://sso.massopen.cloud/auth/realms/moc/broker/cilogon/endpoint**
User -> IdP: Follows redirect via GET, selects identity provider, and authenticates
IdP -> User: 302 https://sso.massopen.cloud/auth/realms/moc/broker/cilogon/endpoint?**code=xxx**&state=xxx
User -> Keycloak: Follows redirect via GET
Keycloak - -> User: 302 https://kaizen.massopen.cloud:13000/v3/auth/OS-FEDERATION/websso/openid#state=xxx&session_state=xxx&**id_token=xxx**
User -> Apache: Follows redirect via GET
Apache -> Keystone: Parses id_token into ENV
Keystone -> Keystone: Parses ENV into user based on mapping\nCreates user if needed
Keystone -> User: 200 OK, sends the user via POST Form to Horizon
User -> Horizon: POST https://kaizen.massopen.cloud/dashboard/auth/websso/\nFORM DATA: **token: xxx**
Horizon -> User: 302 https://kaizen.massopen.cloud/dashboard/
User -> Horizon: Authentication is succesful, dashboard logs user into project
@enduml

PlantUML version 1.2021.6beta6(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>